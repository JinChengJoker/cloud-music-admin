<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>云音乐后台管理</title>
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/main.css">
</head>

<body>
  <div id="layout">
    <aside></aside>
    <main class="border-left"></main>
  </div>

  <script src="../node_modules/leancloud-storage/dist/av-min.js"></script>
  <script>
    AV.init({
      appId: "VUKqBqtjbLHJTAXklfGBbQGA-gzGzoHsz",
      appKey: "iWAtflSEbeKKAdXiLtwttqYK",
      serverURL: "https://vukqbqtj.lc-cn-n1-shared.com"
    })

    // var TestObject = AV.Object.extend('TestObject')
    // var testObject = new TestObject()
    // testObject.set('words', 'Hello world!')
    // testObject.save().then(function (testObject) {
    //   console.log('保存成功。')
    // })
  </script>
  <script src="../node_modules/jquery/dist/jquery.min.js"></script>
  <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="../node_modules/qiniu-js/dist/qiniu.min.js"></script>
  <script>
    $.get('http://localhost:8888/uptoken', function (data) {
      const token = data.uptoken
      const config = {
        useCdnDomain: true,
        region: null
      }
      const putExtra = {
        fname: "",
        params: {},
        mimeType: null
      }
      uploadWithSDK(token, putExtra, config)
    })

    function uploadWithSDK(token, putExtra, config) {
      $("#dragArea input[type='file']").unbind("change").bind("change", function () {
        var file = this.files[0]
        var observable
        if (file) {
          var key = file.name
          putExtra.params["x:name"] = key.split(".")[0]
          // 设置next,error,complete对应的操作，分别处理相应的进度信息，错误信息，以及完成后的操作
          var error = function (err) {
            alert("upload error:" + JSON.stringify(err))
          }
          var complete = function (res) { }
          var next = function (response) { }
          var subObject = {
            next: next,
            error: error,
            complete: complete
          }
          var subscription
          // 调用sdk上传接口获得相应的observable，控制上传和暂停
          observable = qiniu.upload(file, key, token, putExtra, config)
          subscription = observable.subscribe(subObject)
        }
      })
    }
  </script>
  <script src="../src/js/songlist.js"></script>
  <script src="../src/js/upload.js"></script>
  <script src="../src/js/modal.js"></script>
</body>

</html>