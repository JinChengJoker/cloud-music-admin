<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>云音乐后台管理</title>
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/main.css">
</head>

<body>
  <div id="layout">
    <aside>
      <div id="asideTitle" class="bg-light text-center">歌曲列表</div>
      <div id="asideSongList">
        <div class="list-group list-group-flush">
          <button type="button" class="list-group-item list-group-item-action" data-toggle="modal"
            data-target="#staticBackdrop">Cras justo odio</button>
          <button type="button" class="list-group-item list-group-item-action active" data-toggle="modal"
            data-target="#staticBackdrop">Dapibus ac facilisis in</button>
          <button type="button" class="list-group-item list-group-item-action" data-toggle="modal"
            data-target="#staticBackdrop">Morbi leo risus</button>
          <button type="button" class="list-group-item list-group-item-action" data-toggle="modal"
            data-target="#staticBackdrop">Porta ac consectetur ac</button>
          <button type="button" class="list-group-item list-group-item-action" data-toggle="modal"
            data-target="#staticBackdrop">Vestibulum at eros</button>
        </div>
      </div>
    </aside>
    <main class="border-left">
      <div id="uploadContainer">
        <div id="dragArea" class="rounded text-center text-black-50">
          <p>点击或拖拽上传</p>
          <p>单个文件最大限制 10M</p>
          <input type="file">
        </div>
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="staticBackdrop" data-backdrop="static" tabindex="-1" role="dialog"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">编辑歌曲</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="song">歌曲</label>
              <input type="text" class="form-control" id="song">
            </div>
            <div class="form-group">
              <label for="singer">歌手</label>
              <input type="text" class="form-control" id="singer">
            </div>
            <div class="form-group">
              <label for="url">链接</label>
              <input type="text" class="form-control" id="url">
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="../node_modules/leancloud-storage/dist/av-min.js"></script>
  <script>
    AV.init({
      appId: "VUKqBqtjbLHJTAXklfGBbQGA-gzGzoHsz",
      appKey: "iWAtflSEbeKKAdXiLtwttqYK",
      serverURL: "https://vukqbqtj.lc-cn-n1-shared.com"
    })

    // var TestObject = AV.Object.extend('TestObject')
    // var testObject = new TestObject()
    // testObject.set('words', 'Hello world!')
    // testObject.save().then(function (testObject) {
    //   console.log('保存成功。')
    // })
  </script>
  <script src="../node_modules/jquery/dist/jquery.min.js"></script>
  <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="../node_modules/qiniu-js/dist/qiniu.min.js"></script>
  <script>
    $.get('http://localhost:8888/uptoken', function (data) {
      const token = data.uptoken
      const config = {
        useCdnDomain: true,
        region: null
      }
      const putExtra = {
        fname: "",
        params: {},
        mimeType: null
      }
      uploadWithSDK(token, putExtra, config)
    })

    function uploadWithSDK(token, putExtra, config) {
      $("#dragArea input[type='file']").unbind("change").bind("change", function () {
        var file = this.files[0]
        var observable
        if (file) {
          var key = file.name
          putExtra.params["x:name"] = key.split(".")[0]
          // 设置next,error,complete对应的操作，分别处理相应的进度信息，错误信息，以及完成后的操作
          var error = function (err) {
            alert("upload error:" + JSON.stringify(err))
          }
          var complete = function (res) { }
          var next = function (response) { }
          var subObject = {
            next: next,
            error: error,
            complete: complete
          }
          var subscription
          // 调用sdk上传接口获得相应的observable，控制上传和暂停
          observable = qiniu.upload(file, key, token, putExtra, config)
          subscription = observable.subscribe(subObject)
        }
      })
    }
  </script>
</body>

</html>